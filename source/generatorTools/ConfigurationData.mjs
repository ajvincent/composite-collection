import CollectionType from "./CollectionType.mjs";
void (CollectionType);
class ParameterNames {
    WeakMap = [];
    Map = [];
    WeakSet = [];
    Set = [];
}
class OneToOneData {
    key;
    baseConfig;
    options;
    constructor(key, baseConfig, options) {
        this.key = key;
        this.baseConfig = baseConfig;
        this.options = JSON.parse(JSON.stringify(options));
        Object.freeze(this);
        Object.freeze(this.options);
    }
}
/**
 * Configuration data class for internal use.  This class should never throw exceptions intentionally.
 */
export default class ConfigurationData {
    static #configToDataMap = new WeakMap;
    /** @type {ConfigurationData} */
    static #weakMapMockConfigurationData;
    static WeakMapConfiguration = Symbol("WeakMapConfiguration");
    static cloneData(configuration) {
        if (configuration === this.WeakMapConfiguration) {
            let data = this.#weakMapMockConfigurationData;
            if (!data) {
                data = new ConfigurationData("WeakMap", "");
                data.defineArgument(new CollectionType("key", "WeakMap", "object", "The key.", ""));
                this.#weakMapMockConfigurationData = data;
            }
            return data.cloneData();
        }
        if (typeof configuration === "symbol")
            return undefined;
        const data = this.#configToDataMap.get(configuration);
        return data?.cloneData();
    }
    /** @type {string} @constant */
    className;
    /** @type {string} @constant */
    collectionTemplate;
    /** @type {string | null} */
    fileOverview = null;
    /** @type {string} */
    importLines = "";
    /** @type {Map<string, CollectionType>} */
    parameterToTypeMap = new Map;
    /** @type {ParameterNames} */
    #parameterNames = new ParameterNames;
    /** @type {CollectionType | null} */
    valueType = null;
    #oneToOneData = null;
    constructor(className, collectionTemplate) {
        this.className = className;
        this.collectionTemplate = collectionTemplate;
        this.#markReadonly("className");
    }
    #markReadonly(...keys) {
        keys.forEach(key => {
            Reflect.defineProperty(this, key, ConfigurationData.#readonlyDesc);
        });
    }
    static #readonlyDesc = {
        writable: false,
        enumerable: true,
        configurable: false
    };
    get requiresKeyHasher() {
        return this.collectionTemplate.includes("Strong");
    }
    get requiresWeakKey() {
        return this.collectionTemplate.includes("Weak");
    }
    setFileOverview(overview) {
        this.fileOverview = overview;
        this.#markReadonly("fileOverview");
    }
    defineArgument(collectionType) {
        this.parameterToTypeMap.set(collectionType.argumentName, collectionType);
        this.#parameterNames[collectionType.mapOrSetType].push(collectionType.argumentName);
    }
    get weakMapKeys() {
        return this.#parameterNames.WeakMap.slice();
    }
    get strongMapKeys() {
        return this.#parameterNames.Map.slice();
    }
    get weakSetElements() {
        return this.#parameterNames.WeakSet.slice();
    }
    get strongSetElements() {
        return this.#parameterNames.Set.slice();
    }
    /** @type {string} */
    get oneToOneKeyName() {
        return this.#oneToOneData?.key ?? "";
    }
    /** @type {object | null} */
    get oneToOneBase() {
        return this.#oneToOneData?.baseConfig ?? null;
    }
    /** @type {object | null} */
    get oneToOneOptions() {
        return this.#oneToOneData?.options ?? null;
    }
    setOneToOne(key, baseConfig, options) {
        this.#oneToOneData = new OneToOneData(key, baseConfig, options);
    }
    cloneData() {
        const result = new ConfigurationData(this.className, this.collectionTemplate);
        this.#assignToClone(result);
        return result;
    }
    /**
     * Copy properties from this to the target.
     *
     * @param {ConfigurationData} target The target.
     */
    #assignToClone(target) {
        if (this.fileOverview)
            target.setFileOverview(this.fileOverview);
        target.importLines = this.importLines;
        // Argument parameters
        for (let value of this.parameterToTypeMap.values())
            target.defineArgument(value);
        target.valueType = this.valueType;
        if (this.#oneToOneData) {
            target.setOneToOne(this.#oneToOneData.key, this.#oneToOneData.baseConfig, this.#oneToOneData.options);
        }
    }
    setConfiguration(configuration) {
        ConfigurationData.#configToDataMap.set(configuration, this);
    }
}
Object.freeze(ConfigurationData.prototype);
Object.freeze(ConfigurationData);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29uZmlndXJhdGlvbkRhdGEubWpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiQ29uZmlndXJhdGlvbkRhdGEubXRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sY0FBYyxNQUFNLHNCQUFzQixDQUFDO0FBQ2xELEtBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztBQUVyQixNQUFNLGNBQWM7SUFDbEIsT0FBTyxHQUFhLEVBQUUsQ0FBQztJQUN2QixHQUFHLEdBQWEsRUFBRSxDQUFDO0lBQ25CLE9BQU8sR0FBYSxFQUFFLENBQUM7SUFDdkIsR0FBRyxHQUFhLEVBQUUsQ0FBQztDQUNwQjtBQU1ELE1BQU0sWUFBWTtJQUNoQixHQUFHLENBQVM7SUFDWixVQUFVLENBQW1DO0lBQzdDLE9BQU8sQ0FBa0I7SUFFekIsWUFBWSxHQUFXLEVBQUUsVUFBNEMsRUFBRSxPQUFlO1FBQ3BGLElBQUksQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDO1FBQ2YsSUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUM7UUFDN0IsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUVuRCxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3BCLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQzlCLENBQUM7Q0FDRjtBQUVEOztHQUVHO0FBQ0gsTUFBTSxDQUFDLE9BQU8sT0FBTyxpQkFBaUI7SUFDcEMsTUFBTSxDQUFDLGdCQUFnQixHQUF3RCxJQUFJLE9BQU8sQ0FBQztJQUUzRixnQ0FBZ0M7SUFDaEMsTUFBTSxDQUFDLDZCQUE2QixDQUFxQjtJQUV6RCxNQUFNLENBQUMsb0JBQW9CLEdBQUcsTUFBTSxDQUFDLHNCQUFzQixDQUFDLENBQUM7SUFFN0QsTUFBTSxDQUFDLFNBQVMsQ0FDZCxhQUErQztRQUcvQyxJQUFJ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LENBQUMsQ0FBQztRQUM1QyxNQUFNLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7UUFFdEMsc0JBQXNCO1FBQ3RCLEtBQUssSUFBSSxLQUFLLElBQUksSUFBSSxDQUFDLGtCQUFrQixDQUFDLE1BQU0sRUFBRTtZQUNoRCxNQUFNLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRS9CLE1BQU0sQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQztRQUVsQyxJQUFJLElBQUksQ0FBQyxhQUFhLEVBQUU7WUFDdEIsTUFBTSxDQUFDLFdBQVcsQ0FDaEIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLEVBQ3RCLElBQUksQ0FBQyxhQUFhLENBQUMsVUFBVSxFQUM3QixJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FDM0IsQ0FBQztTQUNIO0lBQ0gsQ0FBQztJQUVELGdCQUFnQixDQUFDLGFBQXNDO1FBQ3JELGlCQUFpQixDQUFDLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxhQUFhLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDOUQsQ0FBQzs7QUFHSCxNQUFNLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQzNDLE1BQU0sQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBDb2xsZWN0aW9uQ29uZmlndXJhdGlvbiBmcm9tIFwiLi4vQ29sbGVjdGlvbkNvbmZpZ3VyYXRpb24ubWpzXCI7XG5pbXBvcnQgQ29sbGVjdGlvblR5cGUgZnJvbSBcIi4vQ29sbGVjdGlvblR5cGUubWpzXCI7XG52b2lkKENvbGxlY3Rpb25UeXBlKTtcblxuY2xhc3MgUGFyYW1ldGVyTmFtZXMge1xuICBXZWFrTWFwOiBzdHJpbmdbXSA9IFtdO1xuICBNYXA6IHN0cmluZ1tdID0gW107XG4gIFdlYWtTZXQ6IHN0cmluZ1tdID0gW107XG4gIFNldDogc3RyaW5nW10gPSBbXTtcbn1cblxuZXhwb3J0IHR5cGUgb25lVG9PbmVPcHRpb25zID0ge1xuICBwYXRoVG9CYXNlTW9kdWxlPzogc3RyaW5nO1xufVxuXG5jbGFzcyBPbmVUb09uZURhdGEge1xuICBrZXk6IHN0cmluZztcbiAgYmFzZUNvbmZpZzogQ29sbGVjdGlvbkNvbmZpZ3VyYXRpb24gfCBzeW1ib2w7XG4gIG9wdGlvbnM6IG9uZVRvT25lT3B0aW9ucztcblxuICBjb25zdHJ1Y3RvcihrZXk6IHN0cmluZywgYmFzZUNvbmZpZzogQ29sbGVjdGlvbkNvbmZpZ3VyYXRpb24gfCBzeW1ib2wsIG9wdGlvbnM6IG9iamVjdCkge1xuICAgIHRoaXMua2V5ID0ga2V5O1xuICAgIHRoaXMuYmFzZUNvbmZpZyA9IGJhc2VDb25maWc7XG4gICAgdGhpcy5vcHRpb25zID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvcHRpb25zKSk7XG5cbiAgICBPYmplY3QuZnJlZXplKHRoaXMpO1xuICAgIE9iamVjdC5mcmVlemUodGhpcy5vcHRpb25zKTtcbiAgfVxufVxuXG4vKipcbiAqIENvbmZpZ3VyYXRpb24gZGF0YSBjbGFzcyBmb3IgaW50ZXJuYWwgdXNlLiAgVGhpcyBjbGFzcyBzaG91bGQgbmV2ZXIgdGhyb3cgZXhjZXB0aW9ucyBpbnRlbnRpb25hbGx5LlxuICovXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDb25maWd1cmF0aW9uRGF0YSB7XG4gIHN0YXRpYyAjY29uZmlnVG9EYXRhTWFwOiBXZWFrTWFwPENvbGxlY3Rpb25Db25maWd1cmF0aW9uLCBDb25maWd1cmF0aW9uRGF0YT4gPSBuZXcgV2Vha01hcDtcblxuICAvKiogQHR5cGUge0NvbmZpZ3VyYXRpb25EYXRhfSAqL1xuICBzdGF0aWMgI3dlYWtNYXBNb2NrQ29uZmlndXJhdGlvbkRhdGE/OiBDb25maWd1cmF0aW9uRGF0YTtcblxuICBzdGF0aWMgV2Vha01hcENvbmZpZ3VyYXRpb24gPSBTeW1ib2woXCJXZWFrTWFwQ29uZmlndXJhdGlvblwiKTtcblxuICBzdGF0aWMgY2xvbmVEYXRhKFxuICAgIGNvbmZpZ3VyYXRpb246IENvbGxlY3Rpb25Db25maWd1cmF0aW9uIHwgc3ltYm9sLFxuICApIDogQ29uZmlndXJhdGlvbkRhdGEgfCB1bmRlZmluZWRcbiAge1xuICAgIGlmIChjb25maWd1cmF0aW9uID09PSB0aGlzLldlYWtNYXBDb25maWd1cmF0aW9uKSB7XG4gICAgICBsZXQgZGF0YSA9IHRoaXMuI3dlYWtNYXBNb2NrQ29uZmlndXJhdGlvbkRhdGE7XG5cbiAgICAgIGlmICghZGF0YSkge1xuICAgICAgICBkYXRhID0gbmV3IENvbmZpZ3VyYXRpb25EYXRhKFwiV2Vha01hcFwiLCBcIlwiKVxuICAgICAgICBkYXRhLmRlZmluZUFyZ3VtZW50KG5ldyBDb2xsZWN0aW9uVHlwZShcbiAgICAgICAgICBcImtleVwiLCBcIldlYWtNYXBcIiwgXCJvYmplY3RcIiwgXCJUaGUga2V5LlwiLCBcIlwiXG4gICAgICAgICkpO1xuICAgICAgICB0aGlzLiN3ZWFrTWFwTW9ja0NvbmZpZ3VyYXRpb25EYXRhID0gZGF0YTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGRhdGEuY2xvbmVEYXRhKCk7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiBjb25maWd1cmF0aW9uID09PSBcInN5bWJvbFwiKVxuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICBjb25zdCBkYXRhID0gdGhpcy4jY29uZmlnVG9EYXRhTWFwLmdldChjb25maWd1cmF0aW9uKTtcbiAgICByZXR1cm4gZGF0YT8uY2xvbmVEYXRhKCk7XG4gIH1cblxuICAvKiogQHR5cGUge3N0cmluZ30gQGNvbnN0YW50ICovXG4gIGNsYXNzTmFtZTogc3RyaW5nO1xuXG4gIC8qKiBAdHlwZSB7c3RyaW5nfSBAY29uc3RhbnQgKi9cbiAgY29sbGVjdGlvblRlbXBsYXRlOiBzdHJpbmc7XG5cbiAgLyoqIEB0eXBlIHtzdHJpbmcgfCBudWxsfSAqL1xuICBmaWxlT3ZlcnZpZXc6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuXG4gIC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xuICBpbXBvcnRMaW5lcyA9IFwiXCI7XG5cbiAgLyoqIEB0eXBlIHtNYXA8c3RyaW5nLCBDb2xsZWN0aW9uVHlwZT59ICovXG4gIHBhcmFtZXRlclRvVHlwZU1hcDogTWFwPHN0cmluZywgQ29sbGVjdGlvblR5cGU+ID0gbmV3IE1hcDtcblxuICAvKiogQHR5cGUge1BhcmFtZXRlck5hbWVzfSAqL1xuICAjcGFyYW1ldGVyTmFtZXMgPSBuZXcgUGFyYW1ldGVyTmFtZXM7XG5cbiAgLyoqIEB0eXBlIHtDb2xsZWN0aW9uVHlwZSB8IG51bGx9ICovXG4gIHZhbHVlVHlwZTogQ29sbGVjdGlvblR5cGUgfCBudWxsID0gbnVsbDtcblxuICAjb25lVG9PbmVEYXRhOiBPbmVUb09uZURhdGEgfCBudWxsID0gbnVsbDtcblxuICBjb25zdHJ1Y3RvcihjbGFzc05hbWU6IHN0cmluZywgY29sbGVjdGlvblRlbXBsYXRlOiBzdHJpbmcpIHtcbiAgICB0aGlzLmNsYXNzTmFtZSA9IGNsYXNzTmFtZTtcbiAgICB0aGlzLmNvbGxlY3Rpb25UZW1wbGF0ZSA9IGNvbGxlY3Rpb25UZW1wbGF0ZTtcbiAgICB0aGlzLiNtYXJrUmVhZG9ubHkoXCJjbGFzc05hbWVcIik7XG4gIH1cblxuICAjbWFya1JlYWRvbmx5KC4uLmtleXM6IHN0cmluZ1tdKSA6IHZvaWQge1xuICAgIGtleXMuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgUmVmbGVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBrZXksIENvbmZpZ3VyYXRpb25EYXRhLiNyZWFkb25seURlc2MpO1xuICAgIH0pXG4gIH1cblxuICBzdGF0aWMgI3JlYWRvbmx5RGVzYzogUmVhZG9ubHk8UHJvcGVydHlEZXNjcmlwdG9yPiA9IHtcbiAgICB3cml0YWJsZTogZmFsc2UsXG4gICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICBjb25maWd1cmFibGU6IGZhbHNlXG4gIH07XG5cbiAgZ2V0IHJlcXVpcmVzS2V5SGFzaGVyKCkgOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5jb2xsZWN0aW9uVGVtcGxhdGUuaW5jbHVkZXMoXCJTdHJvbmdcIik7XG4gIH1cblxuICBnZXQgcmVxdWlyZXNXZWFrS2V5KCkgOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5jb2xsZWN0aW9uVGVtcGxhdGUuaW5jbHVkZXMoXCJXZWFrXCIpO1xuICB9XG5cbiAgc2V0RmlsZU92ZXJ2aWV3KG92ZXJ2aWV3OiBzdHJpbmcpIDogdm9pZCB7XG4gICAgdGhpcy5maWxlT3ZlcnZpZXcgPSBvdmVydmlldztcbiAgICB0aGlzLiNtYXJrUmVhZG9ubHkoXCJmaWxlT3ZlcnZpZXdcIik7XG4gIH1cblxuICBkZWZpbmVBcmd1bWVudChjb2xsZWN0aW9uVHlwZTogQ29sbGVjdGlvblR5cGUpIDogdm9pZCB7XG4gICAgdGhpcy5wYXJhbWV0ZXJUb1R5cGVNYXAuc2V0KGNvbGxlY3Rpb25UeXBlLmFyZ3VtZW50TmFtZSwgY29sbGVjdGlvblR5cGUpO1xuICAgIHRoaXMuI3BhcmFtZXRlck5hbWVzW2NvbGxlY3Rpb25UeXBlLm1hcE9yU2V0VHlwZV0ucHVzaChjb2xsZWN0aW9uVHlwZS5hcmd1bWVudE5hbWUpO1xuICB9XG5cbiAgZ2V0IHdlYWtNYXBLZXlzKCkgOiBzdHJpbmdbXSB7XG4gICAgcmV0dXJuIHRoaXMuI3BhcmFtZXRlck5hbWVzLldlYWtNYXAuc2xpY2UoKTtcbiAgfVxuXG4gIGdldCBzdHJvbmdNYXBLZXlzKCk6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gdGhpcy4jcGFyYW1ldGVyTmFtZXMuTWFwLnNsaWNlKCk7XG4gIH1cblxuICBnZXQgd2Vha1NldEVsZW1lbnRzKCkgOiBzdHJpbmdbXSB7XG4gICAgcmV0dXJuIHRoaXMuI3BhcmFtZXRlck5hbWVzLldlYWtTZXQuc2xpY2UoKTtcbiAgfVxuXG4gIGdldCBzdHJvbmdTZXRFbGVtZW50cygpIDogc3RyaW5nW10ge1xuICAgIHJldHVybiB0aGlzLiNwYXJhbWV0ZXJOYW1lcy5TZXQuc2xpY2UoKTtcbiAgfVxuXG4gIC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xuICBnZXQgb25lVG9PbmVLZXlOYW1lKCkgOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLiNvbmVUb09uZURhdGE/LmtleSA/PyBcIlwiO1xuICB9XG5cbiAgLyoqIEB0eXBlIHtvYmplY3QgfCBudWxsfSAqL1xuICBnZXQgb25lVG9PbmVCYXNlKCk6IENvbGxlY3Rpb25Db25maWd1cmF0aW9uIHwgc3ltYm9sIHwgbnVsbCB7XG4gICAgcmV0dXJuIHRoaXMuI29uZVRvT25lRGF0YT8uYmFzZUNvbmZpZyA/PyBudWxsO1xuICB9XG5cbiAgLyoqIEB0eXBlIHtvYmplY3QgfCBudWxsfSAqL1xuICBnZXQgb25lVG9PbmVPcHRpb25zKCkgOiBvbmVUb09uZU9wdGlvbnMgfCBudWxsIHtcbiAgICByZXR1cm4gdGhpcy4jb25lVG9PbmVEYXRhPy5vcHRpb25zID8/IG51bGw7XG4gIH1cblxuICBzZXRPbmVUb09uZShrZXk6IHN0cmluZywgYmFzZUNvbmZpZzogQ29sbGVjdGlvbkNvbmZpZ3VyYXRpb24gfCBzeW1ib2wsIG9wdGlvbnM6IG9uZVRvT25lT3B0aW9ucykgOiB2b2lkIHtcbiAgICB0aGlzLiNvbmVUb09uZURhdGEgPSBuZXcgT25lVG9PbmVEYXRhKGtleSwgYmFzZUNvbmZpZywgb3B0aW9ucyk7XG4gIH1cblxuICBjbG9uZURhdGEoKSA6IENvbmZpZ3VyYXRpb25EYXRhIHtcbiAgICBjb25zdCByZXN1bHQgPSBuZXcgQ29uZmlndXJhdGlvbkRhdGEodGhpcy5jbGFzc05hbWUsIHRoaXMuY29sbGVjdGlvblRlbXBsYXRlKTtcbiAgICB0aGlzLiNhc3NpZ25Ub0Nsb25lKHJlc3VsdCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb3B5IHByb3BlcnRpZXMgZnJvbSB0aGlzIHRvIHRoZSB0YXJnZXQuXG4gICAqXG4gICAqIEBwYXJhbSB7Q29uZmlndXJhdGlvbkRhdGF9IHRhcmdldCBUaGUgdGFyZ2V0LlxuICAgKi9cbiAgI2Fzc2lnblRvQ2xvbmUodGFyZ2V0OiBDb25maWd1cmF0aW9uRGF0YSkgOiB2b2lkIHtcbiAgICBpZiAodGhpcy5maWxlT3ZlcnZpZXcpXG4gICAgICB0YXJnZXQuc2V0RmlsZU92ZXJ2aWV3KHRoaXMuZmlsZU92ZXJ2aWV3KTtcbiAgICB0YXJnZXQuaW1wb3J0TGluZXMgPSB0aGlzLmltcG9ydExpbmVzO1xuXG4gICAgLy8gQXJndW1lbnQgcGFyYW1ldGVyc1xuICAgIGZvciAobGV0IHZhbHVlIG9mIHRoaXMucGFyYW1ldGVyVG9UeXBlTWFwLnZhbHVlcygpKVxuICAgICAgdGFyZ2V0LmRlZmluZUFyZ3VtZW50KHZhbHVlKTtcblxuICAgIHRhcmdldC52YWx1ZVR5cGUgPSB0aGlzLnZhbHVlVHlwZTtcblxuICAgIGlmICh0aGlzLiNvbmVUb09uZURhdGEpIHtcbiAgICAgIHRhcmdldC5zZXRPbmVUb09uZShcbiAgICAgICAgdGhpcy4jb25lVG9PbmVEYXRhLmtleSxcbiAgICAgICAgdGhpcy4jb25lVG9PbmVEYXRhLmJhc2VDb25maWcsXG4gICAgICAgIHRoaXMuI29uZVRvT25lRGF0YS5vcHRpb25zXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIHNldENvbmZpZ3VyYXRpb24oY29uZmlndXJhdGlvbjogQ29sbGVjdGlvbkNvbmZpZ3VyYXRpb24pIDogdm9pZCB7XG4gICAgQ29uZmlndXJhdGlvbkRhdGEuI2NvbmZpZ1RvRGF0YU1hcC5zZXQoY29uZmlndXJhdGlvbiwgdGhpcyk7XG4gIH1cbn1cblxuT2JqZWN0LmZyZWV6ZShDb25maWd1cmF0aW9uRGF0YS5wcm90b3R5cGUpO1xuT2JqZWN0LmZyZWV6ZShDb25maWd1cmF0aW9uRGF0YSk7XG4iXX0=